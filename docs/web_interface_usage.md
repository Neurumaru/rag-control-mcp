# MCP-RAG-Control 웹 인터페이스 사용 가이드

## 1. 개요

MCP-RAG-Control의 Streamlit 웹 인터페이스는 사용자가 코드 없이도 GUI를 통해 시스템을 완전히 활용할 수 있도록 설계되었습니다.

## 2. 시작하기

### 2.1 서버 실행

1. **백엔드 API 서버 시작**
```bash
uvicorn mcp_rag_control.api.app:app --reload --port 8000
```

2. **웹 인터페이스 시작** (새 터미널)
```bash
cd web_interface
streamlit run app.py --server.port 8501
```

3. **웹 브라우저에서 접속**
- 웹 인터페이스: http://localhost:8501
- API 문서: http://localhost:8000/docs

### 2.2 시스템 상태 확인

웹 인터페이스에 접속하면 사이드바에서 API 서버 상태를 확인할 수 있습니다:
- 🟢 온라인: API 서버가 정상 작동 중
- 🔴 오프라인: API 서버에 연결할 수 없음

## 3. 페이지별 사용법

### 3.1 홈 대시보드 (🏠)

**주요 기능:**
- 시스템 전체 상태 모니터링
- 등록된 모듈 및 파이프라인 통계
- 일일 쿼리 수 및 평균 응답시간
- 최근 활동 차트
- 최근 파이프라인 실행 내역

**사용법:**
1. 대시보드에서 시스템 전체 현황을 한눈에 파악
2. 메트릭 카드에서 주요 지표 확인
3. 차트를 통해 시간별 사용 패턴 분석
4. 최근 실행 테이블에서 성공/실패 현황 확인

### 3.2 모듈 관리 (🔧)

**주요 기능:**
- 모듈 목록 조회 및 필터링
- 새 모듈 등록
- 기존 모듈 수정/삭제
- 모듈 상세 정보 조회

#### 3.2.1 모듈 목록 탭

**사용법:**
1. 모듈 유형 필터를 선택하여 특정 유형만 조회
2. 🔄 새로고침 버튼으로 최신 목록 갱신
3. 각 모듈의 확장 패널에서 상세 정보 확인
4. 수정/삭제 버튼으로 모듈 관리

#### 3.2.2 모듈 등록 탭

**단계별 가이드:**

1. **기본 정보 입력**
   - 모듈 ID: 고유 식별자 (예: `my_vector_store`)
   - 모듈 이름: 사용자 친화적 이름
   - 모듈 유형: 드롭다운에서 선택
   - 설명: 모듈의 목적과 기능 설명

2. **유형별 설정**

   **벡터 스토어 (vector_store):**
   - FAISS: 벡터 차원 설정 (기본: 768)
   - ChromaDB: 컬렉션 이름 설정

   **임베딩 모델 (embedding_model):**
   - 모델 이름: Sentence-Transformers 모델명
   - 디바이스: CPU 또는 CUDA 선택

   **언어 모델 (llm):**
   - OpenAI: 모델 선택 및 API 키 입력
   - HuggingFace: 모델 이름 및 API 키 (선택사항)

   **데이터 소스 (data_source):**
   - 데이터베이스: 연결 문자열 입력
   - API: 기본 URL 및 API 키 입력

3. **등록 완료**
   - 모든 필수 정보 입력 후 "모듈 등록" 버튼 클릭
   - 성공시 확인 메시지 표시 및 목록 갱신

### 3.3 파이프라인 관리 (🔗)

**주요 기능:**
- 파이프라인 목록 조회
- 새 파이프라인 생성
- 기존 파이프라인 편집
- 파이프라인 삭제

#### 3.3.1 파이프라인 목록 탭

**사용법:**
1. 등록된 파이프라인 목록 확인
2. 각 파이프라인의 모듈 수, 생성일 등 정보 조회
3. 실행 버튼으로 바로 RAG 테스트 페이지로 이동
4. 편집/삭제 버튼으로 파이프라인 관리

#### 3.3.2 파이프라인 생성 탭

**단계별 가이드:**

1. **기본 정보 입력**
   - 파이프라인 ID: 고유 식별자
   - 파이프라인 이름: 사용자 친화적 이름
   - 설명: 파이프라인의 목적과 구성 설명

2. **모듈 구성**
   - 등록된 모듈 목록에서 선택
   - 실행 단계 번호 지정 (순서대로 실행됨)
   - ➕ 모듈 추가 버튼으로 파이프라인에 추가

3. **모듈별 설정**
   - 각 모듈의 설정 패널에서 세부 설정
   - 입력 필드: 이전 단계의 출력 필드명
   - 출력 필드: 현재 단계의 출력 필드명
   - 작업: 모듈에서 수행할 작업 유형

4. **파이프라인 생성**
   - 모든 설정 완료 후 🚀 파이프라인 생성 버튼 클릭
   - 성공시 확인 메시지 및 목록 갱신

**예시 파이프라인 구성:**
```
단계 1: 데이터 소스 모듈 (문서 검색)
├── 작업: query
├── 출력 필드: documents

단계 2: 임베딩 모델 (벡터 변환)
├── 입력 필드: documents
├── 작업: embed
├── 출력 필드: embeddings

단계 3: 벡터 스토어 (유사도 검색)
├── 입력 필드: embeddings
├── 작업: search
├── 출력 필드: results

단계 4: 언어 모델 (답변 생성)
├── 입력 필드: results
├── 작업: generate
├── 출력 필드: answer
```

### 3.4 RAG 테스트 (🤖)

**주요 기능:**
- 파이프라인 선택 및 실행
- 실시간/비동기 실행 지원
- 실행 결과 상세 분석
- 실행 히스토리 관리

#### 3.4.1 파이프라인 실행

**사용법:**

1. **파이프라인 선택**
   - 사이드바에서 실행할 파이프라인 선택
   - 실행 파라미터 조정 (최대 토큰, Temperature 등)

2. **질문 입력**
   - 메인 텍스트 영역에 질문 입력
   - 명확하고 구체적인 질문 권장

3. **실행 방식 선택**
   - 🚀 즉시 실행: 동기 실행, 결과를 바로 확인
   - ⏰ 비동기 실행: 장시간 처리시 사용, 백그라운드 실행

#### 3.4.2 결과 분석

**결과 구성 요소:**

1. **생성된 답변**
   - AI가 생성한 최종 답변
   - 마크다운 형식으로 표시

2. **참조 소스**
   - 답변 생성에 사용된 소스 문서들
   - 관련도 점수와 함께 표시
   - 각 소스의 메타데이터 정보 포함

3. **실행 정보**
   - 처리 시간: 전체 파이프라인 실행 시간
   - 사용 토큰: LLM 토큰 사용량
   - 파이프라인 ID: 실행된 파이프라인 정보

#### 3.4.3 실행 히스토리

**기능:**
- 최근 10개 실행 기록 보관
- 실행 유형별 아이콘 표시 (🚀 동기, ⏰ 비동기)
- 질문, 답변, 실행 시간 등 요약 정보
- 과거 실행 결과 재확인 가능

### 3.5 시스템 설정 (⚙️)

**주요 기능:**
- API 연결 설정
- UI 테마 및 언어 설정
- 시스템 전역 설정 관리

**설정 항목:**
1. **API 설정**
   - API 호스트 및 포트 설정
   - 연결 상태 확인

2. **UI 설정**
   - 테마 선택 (자동/라이트/다크)
   - 언어 설정 (한국어/English)

## 4. 사용 팁

### 4.1 효과적인 모듈 관리

1. **명명 규칙 준수**
   - 모듈 ID: 영문자, 숫자, 언더스코어만 사용
   - 모듈 이름: 기능을 명확히 나타내는 이름 사용

2. **설정 정보 보안**
   - API 키는 안전하게 관리
   - 프로덕션 환경에서는 환경 변수 활용 권장

3. **모듈 테스트**
   - 모듈 등록 후 간단한 파이프라인으로 동작 확인
   - 문제 발생시 로그 확인

### 4.2 파이프라인 설계 모범 사례

1. **단계별 설계**
   - 명확한 입력/출력 필드명 사용
   - 각 단계의 역할을 명확히 정의

2. **성능 최적화**
   - 불필요한 중간 단계 제거
   - 캐싱 가능한 단계 식별

3. **오류 처리**
   - 각 모듈의 오류 시나리오 고려
   - 대체 경로 또는 기본값 설정

### 4.3 RAG 테스트 효율화

1. **질문 작성 가이드**
   - 구체적이고 명확한 질문 작성
   - 도메인 지식이 필요한 질문으로 테스트

2. **결과 평가**
   - 답변의 정확성 확인
   - 참조 소스의 관련성 검토
   - 응답 시간 모니터링

3. **파라미터 조정**
   - Temperature: 창의성 vs 일관성 조절
   - 최대 토큰: 답변 길이 제어

## 5. 문제 해결

### 5.1 일반적인 문제

**API 서버 연결 실패:**
- API 서버가 실행 중인지 확인
- 포트 번호 확인 (기본: 8000)
- 방화벽 설정 확인

**모듈 등록 실패:**
- 모듈 ID 중복 확인
- 필수 필드 누락 확인
- API 키 유효성 확인

**파이프라인 실행 실패:**
- 모든 모듈이 정상 작동하는지 확인
- 입력/출력 필드명 일치 여부 확인
- 각 모듈의 설정 정보 검증

### 5.2 성능 문제

**응답 시간 지연:**
- 벡터 스토어 인덱스 최적화
- 불필요한 중간 단계 제거
- 하드웨어 리소스 확인

**메모리 사용량 증가:**
- 임베딩 모델 크기 확인
- 배치 처리 크기 조정
- 가비지 컬렉션 확인

## 6. 고급 사용법

### 6.1 커스텀 모듈 개발

웹 인터페이스에서 지원하지 않는 특수한 모듈이 필요한 경우:

1. **백엔드에서 커스텀 어댑터 구현**
2. **웹 인터페이스의 모듈 등록에서 "custom" 유형 선택**
3. **설정 정보에 커스텀 파라미터 입력**

### 6.2 복잡한 파이프라인 구성

**병렬 처리:**
- 동일한 단계 번호로 여러 모듈 설정
- 결과를 다음 단계에서 병합

**조건부 실행:**
- 모듈 설정에서 조건부 파라미터 활용
- 결과에 따른 분기 로직 구현

### 6.3 모니터링 및 분석

**성능 모니터링:**
- 대시보드의 메트릭 주기적 확인
- 실행 히스토리 패턴 분석
- 병목 구간 식별

**사용자 행동 분석:**
- 자주 사용되는 파이프라인 파악
- 실패율이 높은 구성 개선
- 사용자 피드백 수집

이 가이드를 통해 MCP-RAG-Control 웹 인터페이스를 효과적으로 활용하여 강력한 RAG 시스템을 구축하고 관리할 수 있습니다.